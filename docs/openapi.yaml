openapi: 3.0.3
info:
  title: OpenClaw Assistant API
  version: 1.0.0
servers:
  - url: http://localhost:3000
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
  - bearerAuth: []
paths:
  /health:
    get:
      summary: Health check
      security: []
      responses:
        "200": { description: OK }

  /v1/auth/login:
    post:
      summary: Login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        "200": { description: Token emitted }
        "423": { description: Temporarily locked }
        "429": { description: Rate limited }

  /v1/auth/logout:
    post:
      summary: Logout and clear session cookie
      responses:
        "200": { description: Session cleared }

  /v1/auth/me:
    get:
      summary: Current authenticated actor
      responses:
        "200": { description: Actor data }

  /v1/auth/keys:
    get:
      summary: JWT key metadata (admin only)
      responses:
        "200": { description: Key metadata }

  /v1/projects:
    post:
      summary: Create project
      responses:
        "201": { description: Created }
    get:
      summary: List projects
      responses:
        "200": { description: OK }

  /v1/projects/{id}:
    get:
      summary: Get project by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Project detail }
    patch:
      summary: Update project name/status
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Updated }
    delete:
      summary: Delete project
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "204": { description: Deleted }

  /v1/projects/{id}/tasks:
    post:
      summary: Create task (emits task_created)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "201": { description: Created }
    get:
      summary: List tasks
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }

  /v1/projects/{id}/tasks/{taskId}/status:
    patch:
      summary: Update task status
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: path
          name: taskId
          required: true
          schema: { type: string }
      responses:
        "200": { description: Updated }

  /v1/chat/conversations:
    post:
      summary: Create conversation
      responses:
        "201": { description: Created }

  /v1/chat/conversations/{id}/messages:
    post:
      summary: Send message
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "201": { description: Created }
    get:
      summary: List messages
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }

  /v1/chat/timeline:
    get:
      summary: List recent chat timeline events
      parameters:
        - in: query
          name: projectId
          schema: { type: string }
        - in: query
          name: conversationId
          schema: { type: string }
        - in: query
          name: role
          schema: { type: string }
        - in: query
          name: from
          schema: { type: string }
        - in: query
          name: to
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 200 }
      responses:
        "200": { description: Timeline list }

  /v1/memory/save:
    post:
      summary: Save namespaced memory item
      responses:
        "201": { description: Created }

  /v1/memory/search:
    get:
      summary: Hybrid memory search (vector + lexical + filters)
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: projectId
          schema: { type: string }
        - in: query
          name: agentId
          schema: { type: string }
        - in: query
          name: scope
          schema: { type: string }
        - in: query
          name: memoryType
          schema: { type: string }
        - in: query
          name: from
          schema: { type: string }
        - in: query
          name: to
          schema: { type: string }
        - in: query
          name: activeProjectId
          schema: { type: string }
        - in: query
          name: currentAgentId
          schema: { type: string }
      responses:
        "200": { description: Ranked memories }

  /v1/memory/panel:
    get:
      summary: Panel-oriented memory search with operational filters
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: projectId
          schema: { type: string }
        - in: query
          name: agentId
          schema: { type: string }
        - in: query
          name: scope
          schema: { type: string }
        - in: query
          name: memoryType
          schema: { type: string }
        - in: query
          name: from
          schema: { type: string }
        - in: query
          name: to
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 200 }
      responses:
        "200": { description: Filtered memory list }

  /v1/memory/reindex:
    post:
      summary: Incremental embedding reindex
      responses:
        "200": { description: Reindex summary }

  /v1/memory/deduplicate:
    post:
      summary: Deduplicate memories
      responses:
        "200": { description: Dedup summary }

  /v1/memory/hygiene/run:
    post:
      summary: Run TTL + dedup + processed_events cleanup
      responses:
        "200": { description: Hygiene summary }

  /v1/memory/{id}/promote-global:
    post:
      summary: Promote memory to global scope
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Updated }

  /v1/memory/{id}/forget:
    post:
      summary: Archive memory as forgotten
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Updated }

  /v1/memory/{id}/block:
    post:
      summary: Block memory
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Updated }

  /v1/automation/rules:
    post:
      summary: Create automation rule
      responses:
        "201": { description: Created }
        "412": { description: Approval required }
    get:
      summary: List rules
      responses:
        "200": { description: OK }

  /v1/automation/rules/{id}/status:
    patch:
      summary: Enable or disable automation rule
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Updated }

  /v1/automation/rules/{id}/test:
    post:
      summary: Trigger manual automation test
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Test run log }

  /v1/automation/runs:
    get:
      summary: List run logs
      responses:
        "200": { description: OK }

  /v1/automation/dead-letters:
    get:
      summary: List dead letters
      responses:
        "200": { description: OK }

  /v1/policy/approvals:
    get:
      summary: List approvals
      responses:
        "200": { description: OK }

  /v1/policy/approvals/{id}/approve:
    post:
      summary: Approve pending sensitive action
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Approved }

  /v1/policy/approvals/{id}/reject:
    post:
      summary: Reject pending sensitive action
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Rejected }

  /v1/policy/audit:
    get:
      summary: List audit records
      responses:
        "200": { description: OK }

  /v1/ops/metrics:
    get:
      summary: Runtime metrics snapshot
      responses:
        "200": { description: OK }

  /v1/ops/memory/metrics:
    get:
      summary: Memory metrics
      responses:
        "200": { description: OK }

  /v1/ops/embedding/runtime:
    get:
      summary: Active embedding runtime pin (provider/model/version)
      responses:
        "200": { description: OK }

  /v1/ops/automation/health:
    get:
      summary: Automation health summary
      responses:
        "200": { description: OK }

  /v1/ops/audit/aggregated:
    get:
      summary: Aggregated sensitive actions
      responses:
        "200": { description: OK }

  /v1/ops/rate-limit/health:
    get:
      summary: Rate limit health panel data
      responses:
        "200": { description: OK }

  /v1/onboarding/rule-templates:
    get:
      summary: List automation rule templates
      responses:
        "200": { description: OK }

  /v1/onboarding/bootstrap-flow:
    post:
      summary: Bootstrap project + conversation + default rule
      responses:
        "201": { description: Flow created }

  /v1/onboarding/bootstrap-from-template:
    post:
      summary: Create automation from onboarding template
      responses:
        "201": { description: Rule created }

  /v1/dashboard:
    get:
      summary: Operational control panel (HTML)
      responses:
        "200": { description: OK }
