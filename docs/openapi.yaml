openapi: 3.0.3
info:
  title: Asistente Personal Modular API
  version: 1.0.0
servers:
  - url: http://localhost:3000
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
  - bearerAuth: []
paths:
  /health:
    get:
      summary: Health check
      security: []
      responses:
        "200":
          description: OK
  /auth/login:
    post:
      summary: Login with seeded user credentials
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        "200":
          description: JWT token generated
  /auth/me:
    get:
      summary: Get authenticated actor
      responses:
        "200":
          description: Current actor
  /chat/conversations:
    post:
      summary: Create conversation
      responses:
        "201":
          description: Created
  /chat/conversations/{id}/messages:
    post:
      summary: Send message
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "201": { description: Created }
    get:
      summary: List messages
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
  /projects:
    post:
      summary: Create project
      responses:
        "201": { description: Created }
    get:
      summary: List projects
      responses:
        "200": { description: OK }
  /projects/{id}/tasks:
    post:
      summary: Create task and emit task_created
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "201": { description: Created }
    get:
      summary: List tasks
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
  /projects/{id}/tasks/{taskId}/status:
    patch:
      summary: Update task status
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: path
          name: taskId
          required: true
          schema: { type: string }
      responses:
        "200": { description: Updated }
  /memory/save:
    post:
      summary: Save memory item
      responses:
        "201": { description: Created }
  /memory/search:
    get:
      summary: Search memory
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: tags
          schema: { type: string, description: Comma separated }
        - in: query
          name: scope
          schema: { type: string }
      responses:
        "200": { description: OK }
  /automation/rules:
    post:
      summary: Create automation rule
      responses:
        "201": { description: Created }
        "412": { description: Approval required for sensitive actions }
    get:
      summary: List rules
      responses:
        "200": { description: OK }
  /automation/rules/{id}/test:
    post:
      summary: Test rule execution
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Run log }
  /automation/runs:
    get:
      summary: List run logs
      responses:
        "200": { description: OK }
  /policy/approvals:
    get:
      summary: List approvals
      responses:
        "200": { description: OK }
  /policy/approvals/{id}/approve:
    post:
      summary: Approve sensitive operation
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Approved }
  /policy/approvals/{id}/reject:
    post:
      summary: Reject sensitive operation
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: Rejected }
  /policy/audit:
    get:
      summary: Query audit records
      responses:
        "200": { description: OK }
  /onboarding/bootstrap-flow:
    post:
      summary: Bootstrap project + conversation + default rule
      responses:
        "201": { description: Bootstrapped }
